<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2024-10-30">

<title>Advanced Data Wrangling with dplyr – FOR 128</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../assets/styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/for128-hex.png" alt="FOR 128 logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-slides-(weeks-1---5" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Slides (Weeks 1 - 5)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-slides-(weeks-1---5">    
        <li>
    <a class="dropdown-item" href="../slides/w1d1.html">
 <span class="dropdown-text">Week 1 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w1d2.html">
 <span class="dropdown-text">Week 1 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w2d1.html">
 <span class="dropdown-text">Week 2 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w2d2.html">
 <span class="dropdown-text">Week 2 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w3d1.html">
 <span class="dropdown-text">Week 3 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w4d1.html">
 <span class="dropdown-text">Week 4 Day 1 (Notes)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w4d2.html">
 <span class="dropdown-text">Week 4 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w5d1.html">
 <span class="dropdown-text">Week 5 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w5d2.html">
 <span class="dropdown-text">Week 5 Day 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-slides-(weeks-6" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Slides (Weeks 6+)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-slides-(weeks-6">    
        <li>
    <a class="dropdown-item" href="../slides/w6d1.html">
 <span class="dropdown-text">Week 6 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w7d1.html">
 <span class="dropdown-text">Week 7 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w7d2.html">
 <span class="dropdown-text">Week 7 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w8d1.html">
 <span class="dropdown-text">Week 8 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w8d2.html">
 <span class="dropdown-text">Week 8 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w9d1.html">
 <span class="dropdown-text">Week 9 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w10d1.html">
 <span class="dropdown-text">Week 10 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w10d2.html">
 <span class="dropdown-text">Week 10 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w11d1.html">
 <span class="dropdown-text">Week 11 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w11d2.html">
 <span class="dropdown-text">Week 11 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w12d1.html">
 <span class="dropdown-text">Week 12 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w12d2.html">
 <span class="dropdown-text">Week 12 Day 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w13d1.html">
 <span class="dropdown-text">Week 13 Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/w14d1.html">
 <span class="dropdown-text">Week 14 Day 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../midterm2.html"> 
<span class="menu-text">Midterm II</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../final_project.html"> 
<span class="menu-text">Final Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../recordings.html"> 
<span class="menu-text">Lecture Recordings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.finley-lab.com/files/ifdar/" rel="noopener noreferrer" target="_blank"> 
<span class="menu-text">Textbook</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#welcome" id="toc-welcome" class="nav-link active" data-scroll-target="#welcome">Welcome</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives</a></li>
  <li><a href="#deliverables-i.e.-what-to-put-in-the-lab-drop-box" id="toc-deliverables-i.e.-what-to-put-in-the-lab-drop-box" class="nav-link" data-scroll-target="#deliverables-i.e.-what-to-put-in-the-lab-drop-box">Deliverables (i.e., what to put in the lab drop box)</a></li>
  <li><a href="#collaborators" id="toc-collaborators" class="nav-link" data-scroll-target="#collaborators">Collaborator(s)</a></li>
  </ul></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#data-pdxtrees" id="toc-data-pdxtrees" class="nav-link" data-scroll-target="#data-pdxtrees">Data: <code>pdxTrees</code></a></li>
  <li><a href="#methods-dplyr" id="toc-methods-dplyr" class="nav-link" data-scroll-target="#methods-dplyr">Methods: <code>dplyr</code></a></li>
  <li><a href="#exercise-0" id="toc-exercise-0" class="nav-link" data-scroll-target="#exercise-0">Exercise 0</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a>
  <ul class="collapse">
  <li><a href="#part-a" id="toc-part-a" class="nav-link" data-scroll-target="#part-a">Part (a)</a></li>
  <li><a href="#part-b" id="toc-part-b" class="nav-link" data-scroll-target="#part-b">Part (b)</a></li>
  </ul></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a>
  <ul class="collapse">
  <li><a href="#part-a-1" id="toc-part-a-1" class="nav-link" data-scroll-target="#part-a-1">Part (a)</a></li>
  <li><a href="#part-b-1" id="toc-part-b-1" class="nav-link" data-scroll-target="#part-b-1">Part (b)</a></li>
  </ul></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise 5</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6">Exercise 6</a></li>
  <li><a href="#exercise-7" id="toc-exercise-7" class="nav-link" data-scroll-target="#exercise-7">Exercise 7</a>
  <ul class="collapse">
  <li><a href="#part-a-2" id="toc-part-a-2" class="nav-link" data-scroll-target="#part-a-2">Part (a)</a></li>
  <li><a href="#part-b-2" id="toc-part-b-2" class="nav-link" data-scroll-target="#part-b-2">Part (b)</a></li>
  <li><a href="#part-c" id="toc-part-c" class="nav-link" data-scroll-target="#part-c">Part (c)</a></li>
  <li><a href="#part-d" id="toc-part-d" class="nav-link" data-scroll-target="#part-d">Part (d)</a></li>
  <li><a href="#part-e" id="toc-part-e" class="nav-link" data-scroll-target="#part-e">Part (e)</a></li>
  <li><a href="#part-f" id="toc-part-f" class="nav-link" data-scroll-target="#part-f">Part (f)</a></li>
  <li><a href="#part-g" id="toc-part-g" class="nav-link" data-scroll-target="#part-g">Part (g)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap up</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Advanced Data Wrangling with <code>dplyr</code></h1>
<p class="subtitle lead">FOR 128: Lab 8</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 30, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="welcome" class="level2">
<h2 class="anchored" data-anchor-id="welcome">Welcome</h2>
<p>Welcome to Lab 8! Today, we’ll focus on writing extensive <code>dplyr</code> code on larger data. We will both use the verbs individually and “write a sentence” with the verbs by stringing them together with pipes.</p>
<section id="learning-objectives" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives">Learning objectives</h3>
<ul>
<li>Use <code>dplyr</code> verbs together with pipes on larger datasets.</li>
</ul>
</section>
<section id="deliverables-i.e.-what-to-put-in-the-lab-drop-box" class="level3">
<h3 class="anchored" data-anchor-id="deliverables-i.e.-what-to-put-in-the-lab-drop-box">Deliverables (i.e., what to put in the lab drop box)</h3>
<p>Upload your rendered PDF (<code>lab_08.pdf</code>) <strong>and</strong> Quarto (<code>lab_08.qmd</code>) document to the lab drop box. Make sure the Quarto document properly renders to PDF.</p>
</section>
<section id="collaborators" class="level3">
<h3 class="anchored" data-anchor-id="collaborators">Collaborator(s)</h3>
<p>List any collaborators you worked with below.</p>
</section>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="data-pdxtrees" class="level2">
<h2 class="anchored" data-anchor-id="data-pdxtrees">Data: <code>pdxTrees</code></h2>
<p>The <code>pdxTrees</code> R package contains measurements of every tree in the Portland, Oregon metro area. In particular, it contains two datasets, which we will call <code>parks</code> and <code>streets</code>. The <code>parks</code> dataset contains all of the trees in 174 parks in Portland. The <code>streets</code> dataset contains all the trees on the streets of Portland. The hex sticker for <code>pdxTrees</code> (as seen below) contains a fun easter egg from the city of Portland, as its graphics are done in a similar fashion to the famous airport carpet.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://mcconville.rbind.io/pdxHexSticker.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:3in"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="methods-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="methods-dplyr">Methods: <code>dplyr</code></h2>
<p>Use <code>dplyr</code> function that we’ve learned over the past few weeks to answer the questions in this lab.</p>
</section>
<section id="exercise-0" class="level2">
<h2 class="anchored" data-anchor-id="exercise-0">Exercise 0</h2>
<p>Load any packages you’ll need for this lab below. Note, you’ll need to install <code>pdxTrees</code> with <code>install.packages("pdxTrees")</code> before you can load it with <code>library(pdxTrees)</code>.</p>
</section>
<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise 1</h2>
<section id="part-a" class="level3">
<h3 class="anchored" data-anchor-id="part-a">Part (a)</h3>
<p>Load the data. For this lab, we will load both the <code>parks</code> and <code>streets</code> datasets. To do so, run the <code>get_pdxTrees_parks()</code> and <code>get_pdxTrees_streets()</code> functions (note, you don’t need to specify any arguments for these functions) and assign them to <code>parks</code> and <code>streets</code>, respectively.</p>
<p>Your datasets should look like this when you print <code>parks</code> and <code>streets</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25,534 × 34
   Longitude Latitude UserID Genus      Family   DBH Inventory_Date      Species
       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;  
 1     -123.     45.6 1      Pseudotsu… Pinac…  37.4 2017-05-09 00:00:00 PSME   
 2     -123.     45.6 2      Pseudotsu… Pinac…  32.5 2017-05-09 00:00:00 PSME   
 3     -123.     45.6 3      Crataegus  Rosac…   9.7 2017-05-09 00:00:00 CRLA   
 4     -123.     45.6 4      Quercus    Fagac…  10.3 2017-05-09 00:00:00 QURU   
 5     -123.     45.6 5      Pseudotsu… Pinac…  33.2 2017-05-09 00:00:00 PSME   
 6     -123.     45.6 6      Pseudotsu… Pinac…  32.1 2017-05-09 00:00:00 PSME   
 7     -123.     45.6 7      Pseudotsu… Pinac…  28.4 2017-05-09 00:00:00 PSME   
 8     -123.     45.6 8      Pseudotsu… Pinac…  27.2 2017-05-09 00:00:00 PSME   
 9     -123.     45.6 9      Pseudotsu… Pinac…  35.2 2017-05-09 00:00:00 PSME   
10     -123.     45.6 10     Pseudotsu… Pinac…  32.4 2017-05-09 00:00:00 PSME   
# ℹ 25,524 more rows
# ℹ 26 more variables: Common_Name &lt;chr&gt;, Condition &lt;chr&gt;, Tree_Height &lt;dbl&gt;,
#   Crown_Width_NS &lt;dbl&gt;, Crown_Width_EW &lt;dbl&gt;, Crown_Base_Height &lt;dbl&gt;,
#   Collected_By &lt;chr&gt;, Park &lt;chr&gt;, Scientific_Name &lt;chr&gt;,
#   Functional_Type &lt;chr&gt;, Mature_Size &lt;fct&gt;, Native &lt;chr&gt;, Edible &lt;chr&gt;,
#   Nuisance &lt;chr&gt;, Structural_Value &lt;dbl&gt;, Carbon_Storage_lb &lt;dbl&gt;,
#   Carbon_Storage_value &lt;dbl&gt;, Carbon_Sequestration_lb &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>streets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 218,602 × 23
   UserID Inventory_Date      Species   DBH Condition Site_Type Site_Width Wires
   &lt;chr&gt;  &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
 1 1      2010-08-21 00:00:00 PRPL     6.10 Good      &lt;NA&gt;               9 High…
 2 2      2010-08-21 00:00:00 ACMA    36.3  Poor      &lt;NA&gt;               9 High…
 3 3      2010-08-21 00:00:00 PLAC    20.5  Fair      &lt;NA&gt;               9 No HV
 4 4      2010-08-21 00:00:00 CO       8.20 Fair      &lt;NA&gt;               9 No HV
 5 5      2010-08-21 00:00:00 ACMA    55.7  Good      &lt;NA&gt;               9 No HV
 6 6      2010-08-21 00:00:00 ACPL    18.6  Good      &lt;NA&gt;               9 No HV
 7 7      2010-08-21 00:00:00 ACPL    18.8  Good      &lt;NA&gt;               9 No HV
 8 8      2010-08-21 00:00:00 ACPL    16    Good      &lt;NA&gt;               9 No HV
 9 9      2010-08-21 00:00:00 QU       6.20 Good      &lt;NA&gt;               9 No HV
10 10     2010-08-21 00:00:00 ACPL    19.3  Fair      &lt;NA&gt;               9 No HV
# ℹ 218,592 more rows
# ℹ 15 more variables: Site_Development &lt;chr&gt;, Site_Size &lt;chr&gt;, Notes &lt;chr&gt;,
#   Address &lt;chr&gt;, Neighborhood &lt;chr&gt;, Collected_By &lt;chr&gt;, Scientific &lt;chr&gt;,
#   Family &lt;chr&gt;, Genus &lt;chr&gt;, Common_Name &lt;chr&gt;, Functional_Type &lt;chr&gt;,
#   Edible &lt;chr&gt;, Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;, Mature_Size &lt;fct&gt;</code></pre>
</div>
</div>
</section>
<section id="part-b" class="level3">
<h3 class="anchored" data-anchor-id="part-b">Part (b)</h3>
<p>Take a look at the documentation by running <code>?get_pdxTrees_parks</code> and <code>?get_pdxTrees_streets</code> in your console, and tell me about two columns (what are their names? what do they measure? units? factor levels? etc.) from each of the datasets (four total).</p>
</section>
</section>
<section id="exercise-2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2">Exercise 2</h2>
<p>Find how many trees of each species (use the common name column for species here and throughout the lab) are in the <code>parks</code> dataset, and order the data from greatest number of trees in a species to least. Notice I’ve called the number of trees <code>num_trees</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 304 × 2
   Common_Name               num_trees
   &lt;chr&gt;                         &lt;int&gt;
 1 Douglas-Fir                    6783
 2 Norway Maple                   1502
 3 Western Redcedar                964
 4 Northern Red Oak                736
 5 Pin Oak                         619
 6 Incense Cedar                   507
 7 Bigleaf Maple                   490
 8 Japanese Flowering Cherry       418
 9 American Elm                    379
10 Giant Sequoia                   349
# ℹ 294 more rows</code></pre>
</div>
</div>
</section>
<section id="exercise-3" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3">Exercise 3</h2>
<p>A staple of Portland living in the springtime is to go out and see the Japanese Flowering Cherry trees beginning to bloom. Find the park with the most Japanese Flowering Cherry trees, and how many there are in that park.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Park                           num_cherries
  &lt;chr&gt;                                 &lt;int&gt;
1 Gov Tom McCall Waterfront Park          104</code></pre>
</div>
</div>
</section>
<section id="exercise-4" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4">Exercise 4</h2>
<section id="part-a-1" class="level3">
<h3 class="anchored" data-anchor-id="part-a-1">Part (a)</h3>
<p>Find the top 5 parks with the most total DBH (i.e.&nbsp;the sum of all the trees DBH in those parks).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Park             total_DBH
  &lt;chr&gt;                &lt;dbl&gt;
1 Mt Tabor Park       31965.
2 Columbia Park       26952.
3 Laurelhurst Park    26890.
4 Washington Park     16081.
5 John Luby Park      14519.</code></pre>
</div>
</div>
<p><em>Mt. Tabor Park is one of my personal favorites in Portland, I used to live just a few blocks away. It is a wonderful place to watch the sun set over the West hills of the city. Not only does it have the most DBH in all of the parks in Portland, but Portland’s drinking water is stored in giant reservoirs at that park!</em></p>
</section>
<section id="part-b-1" class="level3">
<h3 class="anchored" data-anchor-id="part-b-1">Part (b)</h3>
<p>Find the top 5 parks with the highest DBH per tree (in other words, the 5 highest mean DBHs), along with how many trees are in those parks.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  Park               mean_DBH number_of_trees
  &lt;chr&gt;                 &lt;dbl&gt;           &lt;int&gt;
1 Heritage Tree Park     59                 1
2 Johnswood Property     43.1              18
3 Patton Square Park     37.0              13
4 Hancock Park           32.5             104
5 Laurelwood Park        31.2              13</code></pre>
</div>
</div>
<p><em>Wow! Heritage Tree Park has one giant tree!</em></p>
</section>
</section>
<section id="exercise-5" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5">Exercise 5</h2>
<p>There is a column in the <code>parks</code> dataset that represents the amount of carbon (in lbs) each tree has sequestered. Find the park with the highest carbon sequestration.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Park          carbon_sequestered
  &lt;chr&gt;                      &lt;dbl&gt;
1 Mt Tabor Park             36515.</code></pre>
</div>
</div>
<p><em>Nice job, Mt. Tabor!</em></p>
</section>
<section id="exercise-6" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6">Exercise 6</h2>
<p>The <code>parks</code> dataset has a wide variety of numeric columns measuring things from DBH to pollution removal value of a given tree. Take the mean of all of these numeric columns, grouped by park. Make sure to remove NAs in the <code>mean()</code> function.</p>
<p>HINT: In <code>across()</code> you can set <code>.cols = where(is.numeric)</code> to apply a function across all numeric columns.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 174 × 18
   Park       Longitude Latitude   DBH Tree_Height Crown_Width_NS Crown_Width_EW
   &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
 1 Albert Ke…     -123.     45.5  20.5        83.7           32.3           31.8
 2 Alberta P…     -123.     45.6  28.4        96.6           45.5           43.4
 3 Ankeny Pl…     -123.     45.5  30.8        69             62             62.2
 4 April Hil…     -123.     45.5  18.9        47.9           34.0           33  
 5 Arbor Lod…     -123.     45.6  19.2        49.4           39.8           39.7
 6 Argay Park     -123.     45.6  19.6        46.2           35.3           35.3
 7 Berkeley …     -123.     45.5  26.7        72.9           44.9           47.7
 8 Berrydale…     -123.     45.5  23.6        69.8           41.3           39.3
 9 Bloomingt…     -123.     45.5  24.1        62.6           47.9           48.2
10 Brentwood…     -123.     45.5  17.4        40.8           29.7           30.8
# ℹ 164 more rows
# ℹ 11 more variables: Crown_Base_Height &lt;dbl&gt;, Structural_Value &lt;dbl&gt;,
#   Carbon_Storage_lb &lt;dbl&gt;, Carbon_Storage_value &lt;dbl&gt;,
#   Carbon_Sequestration_lb &lt;dbl&gt;, Carbon_Sequestration_value &lt;dbl&gt;,
#   Stormwater_ft &lt;dbl&gt;, Stormwater_value &lt;dbl&gt;, Pollution_Removal_value &lt;dbl&gt;,
#   Pollution_Removal_oz &lt;dbl&gt;, Total_Annual_Services &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise-7" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7">Exercise 7</h2>
<p>For this exercise, consider the <code>streets</code> dataset.</p>
<section id="part-a-2" class="level3">
<h3 class="anchored" data-anchor-id="part-a-2">Part (a)</h3>
<p>There is a column delineating the edibility of the trees in the dataset. Find the possible values for this column and how many trees correspond to each value.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Edible n_rows
  &lt;chr&gt;   &lt;int&gt;
1 fruit    3649
2 no     211954
3 nut      2999</code></pre>
</div>
</div>
</section>
<section id="part-b-2" class="level3">
<h3 class="anchored" data-anchor-id="part-b-2">Part (b)</h3>
<p>Create a new tibble called <code>forager</code> that contains all rows of the <code>streets</code> with edible fruits or nuts but only the columns denoting the common name, neighborhood, condition, and edibility.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>forager</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,648 × 4
   Common_Name Neighborhood Condition Edible
   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt; 
 1 Persimmon   Concordia    Good      fruit 
 2 Walnut      Concordia    Fair      nut   
 3 Walnut      Concordia    Fair      nut   
 4 Walnut      Concordia    Fair      nut   
 5 Walnut      Concordia    Good      nut   
 6 Walnut      Concordia    Fair      nut   
 7 Walnut      Concordia    Fair      nut   
 8 Walnut      Concordia    Poor      nut   
 9 Walnut      Concordia    Fair      nut   
10 Fig         Concordia    Poor      fruit 
# ℹ 6,638 more rows</code></pre>
</div>
</div>
</section>
<section id="part-c" class="level3">
<h3 class="anchored" data-anchor-id="part-c">Part (c)</h3>
<p>Create a new logical column and save it in the <code>forager</code> dataset. Name it <code>fruit_edible</code>. The values in this columns should be <code>TRUE</code> or <code>FALSE</code> depending on if the given tree has edible fruits or not</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>forager</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,648 × 5
   Common_Name Neighborhood Condition Edible fruit_edible
   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt;       
 1 Persimmon   Concordia    Good      fruit  TRUE        
 2 Walnut      Concordia    Fair      nut    FALSE       
 3 Walnut      Concordia    Fair      nut    FALSE       
 4 Walnut      Concordia    Fair      nut    FALSE       
 5 Walnut      Concordia    Good      nut    FALSE       
 6 Walnut      Concordia    Fair      nut    FALSE       
 7 Walnut      Concordia    Fair      nut    FALSE       
 8 Walnut      Concordia    Poor      nut    FALSE       
 9 Walnut      Concordia    Fair      nut    FALSE       
10 Fig         Concordia    Poor      fruit  TRUE        
# ℹ 6,638 more rows</code></pre>
</div>
</div>
</section>
<section id="part-d" class="level3">
<h3 class="anchored" data-anchor-id="part-d">Part (d)</h3>
<p>Arrange the forager dataset by the column you just created in (c), so that the <code>TRUE</code> values are at the top, and save this change to the <code>forager</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>forager</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,648 × 5
   Common_Name Neighborhood Condition Edible fruit_edible
   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt;       
 1 Persimmon   Concordia    Good      fruit  TRUE        
 2 Fig         Concordia    Poor      fruit  TRUE        
 3 Fig         Concordia    Good      fruit  TRUE        
 4 Fig         Concordia    Fair      fruit  TRUE        
 5 Fig         Concordia    Poor      fruit  TRUE        
 6 Fig         Concordia    Good      fruit  TRUE        
 7 Fig         Concordia    Fair      fruit  TRUE        
 8 Persimmon   Concordia    Good      fruit  TRUE        
 9 Persimmon   Concordia    Fair      fruit  TRUE        
10 Persimmon   Concordia    Fair      fruit  TRUE        
# ℹ 6,638 more rows</code></pre>
</div>
</div>
</section>
<section id="part-e" class="level3">
<h3 class="anchored" data-anchor-id="part-e">Part (e)</h3>
<p>The <code>Edible</code> column in named in a bit of a funny way. Rename the column to <code>Edible_Component</code> and save this change to the <code>forager</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>forager</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,648 × 5
   Common_Name Neighborhood Condition Edible_Component fruit_edible
   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;            &lt;lgl&gt;       
 1 Persimmon   Concordia    Good      fruit            TRUE        
 2 Fig         Concordia    Poor      fruit            TRUE        
 3 Fig         Concordia    Good      fruit            TRUE        
 4 Fig         Concordia    Fair      fruit            TRUE        
 5 Fig         Concordia    Poor      fruit            TRUE        
 6 Fig         Concordia    Good      fruit            TRUE        
 7 Fig         Concordia    Fair      fruit            TRUE        
 8 Persimmon   Concordia    Good      fruit            TRUE        
 9 Persimmon   Concordia    Fair      fruit            TRUE        
10 Persimmon   Concordia    Fair      fruit            TRUE        
# ℹ 6,638 more rows</code></pre>
</div>
</div>
</section>
<section id="part-f" class="level3">
<h3 class="anchored" data-anchor-id="part-f">Part (f)</h3>
<p>Which five neighborhoods would a fruit loving forager most like to live (in other words, what are the five neighborhoods with the most trees with edible fruit)?</p>
<p>HINT: using the <code>sum()</code> function on logical data will make all the <code>TRUE</code>s <code>1</code>s and all the <code>FALSE</code>s <code>0</code>s.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Neighborhood      n_edible_fruit_trees
  &lt;chr&gt;                            &lt;int&gt;
1 Montavilla                         166
2 Sellwood-Moreland                  154
3 Richmond                           148
4 Rose City Park                     127
5 Woodstock                          125</code></pre>
</div>
</div>
<p><em>The Sellwood-Moreland and Woodstock neighborhoods are the heart of southeast Portland (in my opinion). The <code>pdxTrees</code> R package was written primarily in the Woodstock neighborhood, as a matter of fact. Sellwood-Moreland sits just to the west of Woodstock and has a variety of top-tier coffee shops, along with a gorgeous riverfront park with off-leash dogs allowed. Quite the place to be if you are a fruit forager, too!</em></p>
</section>
<section id="part-g" class="level3">
<h3 class="anchored" data-anchor-id="part-g">Part (g)</h3>
<p>Of the five neighborhoods found in part (e), what are the conditions of the edible fruit bearing trees (in other words, how many are in Good condition, Fair condition, etc., grouped by these five neighborhoods).</p>
<p>HINT: you can use <code>group_by()</code> to group by multiple groups at once. Example: <code>group_by(column1, column2)</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Neighborhood'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
# Groups:   Neighborhood [5]
   Neighborhood      Condition num_fruit_trees
   &lt;chr&gt;             &lt;chr&gt;               &lt;int&gt;
 1 Montavilla        Fair                   92
 2 Montavilla        Good                   63
 3 Montavilla        Poor                   11
 4 Richmond          Fair                   36
 5 Richmond          Good                  104
 6 Richmond          Poor                    8
 7 Rose City Park    Fair                   71
 8 Rose City Park    Good                   54
 9 Rose City Park    Poor                    2
10 Sellwood-Moreland Fair                   56
11 Sellwood-Moreland Good                   89
12 Sellwood-Moreland Poor                    9
13 Woodstock         Fair                   39
14 Woodstock         Good                   77
15 Woodstock         Poor                    9</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="wrap-up" class="level1">
<h1>Wrap up</h1>
<p>Congratulations! You’ve made it to the end of Lab 8. Make sure to render your final document and submit both the .pdf and .qmd file to D2L.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.for128\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>